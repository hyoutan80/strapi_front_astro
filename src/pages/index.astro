---
import Layout from '../layouts/Layout.astro';
import SpaceBackground from '../components/SpaceBackground.astro';
import CategoryGrid from '../components/CategoryGrid.astro';
import AchievementSection from '../components/AchievementSection.astro';
import ArticleListItem from '../components/ArticleListItem.astro';
import Sidebar from '../components/Sidebar.astro';
import { fetchAPI } from '../lib/strapi';
import type { Article } from '../types';

async function getArticles() {
  try {
    const token = import.meta.env.STRAPI_API_TOKEN;
    const path = `/articles`;
    const urlParamsObject = {
      sort: ["display_date:desc", "publishedAt:desc"],
      populate: {
        cover: { fields: ["url"] },
        category: { populate: "*" },
      },
      pagination: {
        page: 1,
        pageSize: 10, // Limit to 10 for the list view
      },
    };
    const options = { headers: { Authorization: `Bearer ${token}` } };
    const responseData = await fetchAPI(path, urlParamsObject, options);
    return responseData;
  } catch (error) {
    console.error("Failed to fetch articles:", error);
    return { data: [], meta: {} };
  }
}

const { data: articles } = await getArticles();
---

<Layout title="Web3Ships" useMainContainer={false}>
  <div class="flex flex-col gap-12 pb-24">
    <!-- Hero Section -->
    <div class="container mx-auto px-4 md:px-6 pt-8">
      <SpaceBackground>
        <div class="inline-flex items-center rounded-full border border-white/20 bg-white/5 px-3 py-1 text-sm text-white backdrop-blur-sm mb-6">
          <span className="mr-2">ğŸš€</span> æ¬¡ä¸–ä»£Webé–‹ç™ºãƒ¡ãƒ‡ã‚£ã‚¢
        </div>
        <h1 class="text-4xl font-extrabold tracking-tighter sm:text-5xl md:text-6xl lg:text-7xl text-white mb-6 drop-shadow-lg">
          å®‡å®™èˆ¹ã§èˆªæµ·ã™ã‚‹<br class="hidden md:block" />
          ãƒ‡ã‚¸ã‚¿ãƒ«æŠ€è¡“ã®ç¾…é‡ç›¤
        </h1>
        <p class="max-w-[700px] text-white/80 md:text-xl/relaxed lg:text-base/relaxed xl:text-xl/relaxed mb-8">
          Webåˆ¶ä½œãƒ»é–‹ç™ºã‹ã‚‰æœ€æ–°ã®AIãƒ»Web3æŠ€è¡“ã¾ã§ã€<br />
          æ˜æ—¥ã®ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã«å¿…è¦ãªçŸ¥è­˜ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚
        </p>
        <div class="flex flex-col sm:flex-row gap-4">
          <a href="#latest-articles" class="inline-flex h-12 items-center justify-center rounded-md bg-white px-8 text-sm font-medium text-black shadow transition-colors hover:bg-white/90 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50">
            æœ€æ–°è¨˜äº‹ã‚’èª­ã‚€
          </a>
          <a href="/contact" class="inline-flex h-12 items-center justify-center rounded-md border border-white/20 bg-white/10 px-8 text-sm font-medium text-white shadow-sm backdrop-blur-sm transition-colors hover:bg-white/20 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50">
            ãŠå•ã„åˆã‚ã›
          </a>
        </div>
      </SpaceBackground>
    </div>

    <!-- Category Section - Full Width -->
    <div class="-mt-10 relative z-10">
      <CategoryGrid />
    </div>

    <div class="container mx-auto px-4 max-w-7xl space-y-20 relative z-10 pb-20">

      <!-- Main Content Layout (2 Columns) -->
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12" id="latest-articles">
        
        <!-- Main Column: Latest Articles -->
        <main class="lg:col-span-8">
          
          <!-- Development Achievements -->
          <div class="mb-12">
            <AchievementSection />
          </div>

          <div class="mb-8">
             <h2 class="text-xl font-bold tracking-tight mb-4">æœ€æ–°è¨˜äº‹ä¸€è¦§</h2>
             <div class="rounded-xl border border-border/40 bg-card overflow-hidden">
                {articles.length > 0 ? (
                  <div class="flex flex-col">
                    {articles.map((article: Article) => (
                      <ArticleListItem article={article} />
                    ))}
                  </div>
                ) : (
                  <div class="p-12 text-center text-muted-foreground">
                    <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                  </div>
                )}
             </div>
          </div>
        </main>

        <!-- Sidebar -->
        <aside class="lg:col-span-4 sticky top-24 h-fit">
          <Sidebar />
        </aside>

      </div>
    </div>
  </div>
</Layout>
